# Docker

> 컨테이너 기반의 오픈소스 가상화 플랫폼

서버관리는 복잡하다.

### 도커의 특징 

**확장성/이식성**

- 도커가 설치되어 있다면 어디서든 컨테이너를 실행 할 수 있음
- 특정 회사나 서비스에 종속적이지 않음
- 쉽게 개발서버를 만들 수 있고 테스트서버 생성도 간편함

**표준성**

- 도커를 사용하지 않는 경우 python, nodejs, php로 만든 서비스들의 배포 방식은 제각각 다름
- 컨테이너라는 표준으로 서버를 배포하므로 모든 서비스들의 배포과정이 동일해짐

**이미지**

- 이미지에서 컨테이너를 생성하기 때문에 반드시 이미지를 만드는 과정이 필요
- Dockerfile을 이용하여 이미지를 만들고 처음부터 재현 가능
- 빌드 서버에서 이미지를 만들면 해당 이미지를 이미지 저장소에 저장하고 운영서버에서 이미지를 불러옴

**설정관리**

- MYSQL_PASS=password와 같이 컨테이너를 띄울 때 환경변수를 같이 지정
- 하나의 이미지가 환경변수에 따라 동적으로 설정파일을 생성하도록 만들어져야함

**자원관리**

- 컨테이너는 삭제 후 새로 만들면 모든 데이터가 초기화됨
- 업로드 파일을 외부 스토리지와 링크하여 사용하거나 S3같은 별도의 저장소가 필요
- 세션이나 캐시를 memcached나 redis와 같은 외부로 분리

### 컨테이너의 미래

여러대의 서버와 여러개의 서비스를 관리하기 쉽게

**kubernetes **

**스케줄링**

- 컨테이너를 적당한 서버에 배포해 주는 작업
- 여러 대의 서버 중 가장 할일 없는 서버에 배포하거나 그냥 차례대로 배포 또는 아예 랜덤하게 배포
- 컨테이너 개수를 여러 개로 늘리면 적당히 나눠서 배포하고 서버가 죽으면 실행 중이던 컨테이너를 다른 서버에 띄워줌

**클러스터링**

- 여러 개의 서버를 하나의 서버처럼 사용
- 작게는 몇 개 안되는 서버부터 많게는 수천 대의 서버를 하나의 클러스터로
- 여기저기 흩어져 있는 컨테이너도 가상 네트워크를 이용하여 마치 같은 서버에 있는 것처럼 쉽게 통신

**서비스 디스커버리**

- 서비스를 찾아주는 기능
- 클러스터 환경에서 컨테이너는 어느 서버에 생성될 지 알 수 없고 다른 서버로 이동할 수도 있음

- 따라서 컨테이너와 통신을 하기 위해서 어느 서버에서 실행중인지 알아야 하고 컨테이너가 생성되고 중지될 때 어딘가에 IP와  Port같은 정보를 업데이트 해줘야 함
- 키-밸류 스토리지에 정보를 저장할 수 있고 내부 DNS 서버를 이용



### 도커 기본 명령어

```shell
docker run ubuntu:20.04
```



**/bin/sh 실행**

```shell
docker run --rm -it ubuntu:20.04 /bin/sh
```

컨테이너 내부에 들어가기 위해 sh을 실행하고 키보드 입력을 위해 -it 옵션

추가적으로 프로세스가 종료되면 컨테이너가 자동으로 삭제되도록 --rm 옵션

--rm 옵션이 없다면 컨테이너가 종료되더라도 삭제되지 않고 남아있어 수동으로 삭제 해야함

